// Generated by CoffeeScript 1.7.1

/*
 * * tiler
 * * https://github.com/brewster1134/tiler
 * *
 * * Copyright (c) 2014 Ryan Brewster
 * * Licensed under the MIT license.
 */

(function() {
  (function(root, factory) {
    if (typeof define === 'function' && define.amd) {
      return define(['jquery', 'widget', 'effect'], function($) {
        return factory($);
      });
    } else {
      return factory(jQuery);
    }
  })(this, function($) {
    return $.widget('ui.tiler', {
      widgetEventPrefix: 'tiler',
      options: {
        initialTile: [1, 1],
        reverseSupport: true
      },
      _create: function() {
        this.grid = {};
        this.$currentTile = [0, 0];
        return this.$tiles = $('.tiler-tile', this.element);
      },
      _init: function() {
        this._sizeTiles();
        this._buildGrid();
        this._buildLinks();
        return this.goTo.apply(this, this.options.initialTile);
      },
      goTo: function(idOrRow, col) {
        var $enterTile, $exitTile, row, _ref;
        if (col == null) {
          col = null;
        }
        if (!col) {
          row = this.$tiles.filter("#" + idOrRow).data('tiler-row');
          col = this.$tiles.filter("#" + idOrRow).data('tiler-col');
        } else {
          row = idOrRow;
        }
        $exitTile = ((_ref = this.grid[this.$currentTile[0]]) != null ? _ref[this.$currentTile[1]] : void 0) || $();
        $enterTile = this.grid[row][col];
        if (this.$currentTile[0] === row && this.$currentTile[1] === col) {
          return;
        }
        this.$tiles.not($exitTile).not($enterTile).hide();
        this._transitionCss($exitTile, $enterTile);
        this.$currentTile = [row, col];
        return $enterTile;
      },
      _transitionCss: function($exitTile, $enterTile) {
        var col, enterTileClass, enterTileFinalPosition, enterTileInitialPosition, enterTileInitialState, exitTileFinalPosition, exitTileInitialPosition, exitTileInitialState, row;
        enterTileClass = $enterTile.data('tiler-active-class');
        row = $enterTile.data('tiler-row');
        col = $enterTile.data('tiler-col');
        if (!this.options.reverseSupport || this._isNavigatingForward(row, col)) {
          exitTileInitialState = 'exit';
          exitTileInitialPosition = 'start';
          exitTileFinalPosition = 'end';
          enterTileInitialState = 'enter';
          enterTileInitialPosition = 'start';
          enterTileFinalPosition = 'end';
        } else {
          exitTileInitialState = 'enter';
          exitTileInitialPosition = 'end';
          exitTileFinalPosition = 'start';
          enterTileInitialState = 'exit';
          enterTileInitialPosition = 'end';
          enterTileFinalPosition = 'start';
        }
        $exitTile.attr('class', "tiler-tile " + exitTileInitialState);
        $exitTile.addClass(enterTileClass);
        $exitTile.data('tiler-transition', $exitTile.css('transition'));
        $exitTile.data('tiler-transition-duration', $exitTile.css('transition-duration'));
        $exitTile.css('transition-duration', 0);
        $exitTile.addClass(exitTileInitialPosition);
        $exitTile.css({
          transition: $exitTile.data('tiler-transition'),
          transitionDuration: $exitTile.data('tiler-transition-duration')
        });
        $exitTile.show();
        $exitTile.switchClass(exitTileInitialPosition, exitTileFinalPosition);
        $enterTile.attr('class', "tiler-tile " + enterTileInitialState);
        $enterTile.addClass(enterTileClass);
        $enterTile.data('tiler-transition', $enterTile.css('transition'));
        $enterTile.data('tiler-transition-duration', $enterTile.css('transition-duration'));
        $enterTile.css('transition-duration', 0);
        $enterTile.addClass(enterTileInitialPosition);
        $enterTile.css({
          transition: $enterTile.data('tiler-transition'),
          transitionDuration: $enterTile.data('tiler-transition-duration')
        });
        $enterTile.show();
        setTimeout(function() {
          return $enterTile.addClass('active');
        });
        return $enterTile.switchClass(enterTileInitialPosition, enterTileFinalPosition);
      },
      _buildLinks: function() {
        var _this;
        _this = this;
        return $('[data-tiler-link-id]').each(function() {
          var tileId, tileInstance, tileTitle, tilerInstance;
          tileId = $(this).data('tiler-link-id').split(':');
          if (tileId.length === 2) {
            tilerInstance = $(".tiler-viewport#" + tileId[0]);
            tileInstance = $(".tiler-tile#" + tileId[1], tilerInstance);
          } else {
            tileInstance = $(".tiler-tile#" + tileId[0]);
          }
          tileTitle = tileInstance.data('tiler-title');
          return $(this).attr('data-tiler-title', tileTitle);
        });
      },
      _sizeTiles: function() {
        return this.$tiles.css({
          width: this.element.outerWidth(),
          height: this.element.outerHeight()
        });
      },
      _buildGrid: function() {
        var _this;
        _this = this;
        this.$tiles.each(function() {
          var col, row, _base;
          row = $(this).data('tiler-row') || (Object.keys(_this.grid).length + 1);
          col = Object.keys(_this.grid[row] || {}).length + 1;
          $(this).data('tiler-row', row);
          $(this).data('tiler-col', col);
          (_base = _this.grid)[row] || (_base[row] = {});
          return _this.grid[row][col] = $(this);
        });
        return this.grid;
      },
      _isNavigatingForward: function(row, col) {
        var currentCol, currentRow;
        currentRow = this.$currentTile[0];
        currentCol = this.$currentTile[1];
        return (row > currentRow) || (row === currentRow && col >= currentCol);
      }
    });
  });

}).call(this);
